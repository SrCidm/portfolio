---
import { getTranslations, type Language } from '../i18n';

interface Props {
  lang?: Language;
}

const { lang = 'en' } = Astro.props;
const t = getTranslations(lang);

const projects = [
  {
    title: 'CHIGUI',
    status: 'live',
    description: lang === 'es'
      ? 'CHIGUI — Aplicación PWA de aprendizaje de español impulsada por IA. Tutor conversacional con voz, reconocimiento de imágenes y aprendizaje adaptativo. Full‑stack: Next.js 14 (frontend), FastAPI (backend), Firebase para auth y almacenamiento, e integración con Gemini AI para generación de respuestas y voz. Soporta modo offline como PWA y está optimizada para móviles.'
      : 'AI-powered Spanish learning PWA. Conversational tutor with voice, image recognition and adaptive learning. Full‑stack: Next.js 14, FastAPI, Firebase for auth/storage, and Gemini AI for generation and voice. PWA-enabled and mobile-optimized.',
    image: '/images/projects/chigui.webp',
    technologies: ['Next.js', 'FastAPI', 'TypeScript', 'Python', 'Firebase', 'Gemini AI', 'PWA', 'Vercel'],
    github: 'https://github.com/SrCidm/chigui',
    live: 'https://chigui-app.web.app/',
  },
  {
    title: 'Portfolio de Artista',
    status: 'live',
    description: lang === 'es'
      ? 'Portfolio web bilingüe para artista contemporáneo especializado en arte cinético y esculturas lumínicas. Incluye hero animado con 25 frames stop-motion usando Canvas API nativo, galería lightbox con 67 obras, y sistema i18n personalizado. Optimizado con Astro SSG para máxima performance.'
      : 'Bilingual portfolio for contemporary artist specializing in kinetic art and light sculptures. Animated hero with 25-frame stop-motion via Canvas API, lightbox gallery with 67 artworks, custom i18n. Optimized with Astro SSG.',
    image: '/images/projects/Ricardopage.webp',
    technologies: ['Astro', 'TypeScript', 'Tailwind CSS', 'Canvas API'],
    github: 'https://github.com/SrCidm/web-ricardo-laverde',
    live: 'https://ricardolaverde.vercel.app/',
  },
  {
    title: 'Transcriptor AI Audio',
    status: 'live',
    description: lang === 'es'
      ? 'Herramienta CLI en Python para transcribir audios locales, videos de YouTube y reels de Instagram usando el modelo OpenAI Whisper. Soporta FFmpeg para notas de voz de WhatsApp y extrae timestamps automáticos. Ideal para periodistas, podcasters y creadores de contenido.'
      : 'Python CLI tool to transcribe local audio, YouTube videos, and Instagram reels using OpenAI Whisper. FFmpeg support for WhatsApp voice notes and automatic timestamp extraction. Ideal for journalists and content creators.',
    image: '/images/projects/transcrip.webp',
    technologies: ['Python', 'OpenAI Whisper'],
    github: 'https://github.com/SrCidm/Transcriptor',
    live: '',
  },
  {
    title: 'Youingtik Downloader Pro',
    status: 'dev',
    description: lang === 'es'
      ? 'Aplicación de escritorio moderna con UI oscura (CustomTkinter) para descargar videos de YouTube en HD, extraer audio y transcribirlo automáticamente. Soporta 9 idiomas y procesamiento completamente local, sin enviar datos a servidores externos.'
      : 'Modern desktop app with dark UI (CustomTkinter) to download HD YouTube videos, extract audio, and auto-transcribe. Supports 9 languages and fully local processing — no data sent to external servers.',
    image: '/images/projects/YTPRO.webp',
    technologies: ['Python', 'CustomTkinter', 'Tkinter', 'OpenAI Whisper'],
    github: 'https://github.com/SrCidm/youtubeDownloader',
    live: '',
  },
  {
    title: 'Ofertas Destacadas Page',
    status: 'live',
    description: lang === 'es'
      ? 'Web moderna de productos de afiliado de Amazon construida con Astro para máximo rendimiento y SEO. Incluye sistema de filtros, páginas de producto y optimización de Core Web Vitals para maximizar conversiones orgánicas.'
      : 'Modern Amazon affiliate website built with Astro for maximum performance and SEO. Includes filtering system, product pages and Core Web Vitals optimization to maximize organic conversions.',
    image: '/images/projects/OD2.webp',
    technologies: ['Astro', 'TypeScript'],
    github: 'https://github.com/SrCidm/OD',
    live: 'https://ofertasdestacadas.netlify.app/',
  },
  {
    title: 'Pokémon Battle Simulator',
    status: 'archived',
    description: lang === 'es'
      ? 'GUI en PyQt5 para buscar Pokémon, ver estadísticas y simular batallas por turnos entre dos Pokémon. Consume la PokéAPI para datos en tiempo real e implementa cálculo de daño basado en estadísticas reales del juego.'
      : 'PyQt5 GUI to search Pokémon, view stats, and simulate turn-based battles. Consumes PokéAPI for real-time data and implements a damage calculation system based on real game stats.',
    image: '/images/projects/pokemonBattle.webp',
    technologies: ['Python', 'API'],
    github: 'https://github.com/SrCidm/crypto-pagev1',
    live: null,
  },
  {
    title: 'Crypto Page',
    status: 'archived',
    description: lang === 'es'
      ? 'Aplicación web para visualización de datos de criptomonedas en tiempo real con gráficos históricos interactivos y carrusel de tendencias. Construida con React y Material-UI, consume APIs financieras para mostrar precios, volúmenes y variaciones de mercado.'
      : 'Web app for real-time cryptocurrency data visualization with interactive historical charts and trending carousel. Built with React and Material-UI, consuming financial APIs to display prices, volumes and market variations.',
    image: '/images/projects/svgp1.webp',
    technologies: ['React', 'JavaScript', 'Material-UI', 'API'],
    github: 'https://github.com/SrCidm/crypto-pagev1',
    live: null,
  },
  {
    title: 'MeetHub',
    status: 'archived',
    description: lang === 'es'
      ? 'Plataforma para organización y gestión de reuniones empresariales con programación, gestión de invitaciones e integración de calendario. Diseñada con Next.js y Firebase para actualizaciones en tiempo real entre todos los participantes.'
      : 'Business meeting management platform with scheduling, invitation management, and calendar integration. Built with Next.js and Firebase for real-time updates across all participants.',
    image: '/images/projects/mh.webp',
    technologies: ['Next.js', 'JavaScript', 'Tailwind'],
    github: 'https://github.com/SrCidm/MeetHub-Meeting-page',
    live: null,
  },
  {
    title: 'My Weather App',
    status: 'archived',
    description: lang === 'es'
      ? 'Aplicación del clima usando Svelte que muestra datos meteorológicos actuales y pronóstico extendido con búsqueda de ubicación por nombre o geolocalización. Incluye visualización de humedad, viento y probabilidad de lluvia.'
      : 'Weather app using Svelte displaying current weather and extended forecast with location search by name or geolocation. Includes humidity, wind and rain probability visualization.',
    image: '/images/projects/mwapp.webp',
    technologies: ['Svelte', 'JavaScript', 'CSS', 'API'],
    github: 'https://github.com/SrCidm/my-Weather-App',
    live: null,
  },
  {
    title: 'Crypto-Tracker',
    status: 'archived',
    description: lang === 'es'
      ? 'Aplicación de escritorio en Python con Tkinter para obtener información de criptomonedas usando la API de CoinMarketCap. Muestra precios en tiempo real, capitalización de mercado y variaciones en 24h con interfaz gráfica limpia.'
      : 'Python desktop app with Tkinter to retrieve cryptocurrency info using the CoinMarketCap API. Displays real-time prices, market cap and 24h variations with a clean graphical interface.',
    image: '/images/projects/criptotracker.webp',
    technologies: ['Python', 'Tkinter', 'API'],
    github: 'https://github.com/SrCidm/Crypto-Tracker',
    live: null,
  },
  {
    title: 'Ofertas Destacadas',
    status: 'archived',
    description: lang === 'es'
      ? 'Plataforma web para mostrar videos promocionales de productos destacados con enlaces directos a Amazon. Desarrollada con Python para el backend y HTML/CSS para una presentación visual atractiva de los productos.'
      : 'Web platform showcasing promotional videos for featured products with direct Amazon links. Developed with Python backend and HTML/CSS for an attractive visual presentation.',
    image: '/images/projects/OD.webp',
    technologies: ['Python', 'HTML', 'CSS'],
    github: 'https://github.com/SrCidm/OD',
    live: null,
  },
];

const allTechnologies = [...new Set(projects.flatMap(p => p.technologies))].sort();

const statusLabel = {
  live:     lang === 'es' ? 'En Vivo'   : 'Live',
  dev:      lang === 'es' ? 'En Dev'    : 'In Dev',
  archived: lang === 'es' ? 'Archivado' : 'Archived',
};
const closeText    = lang === 'es' ? 'Cerrar'      : 'Close';
const zoomInText   = lang === 'es' ? 'Acercar'     : 'Zoom in';
const zoomOutText  = lang === 'es' ? 'Alejar'      : 'Zoom out';
const resetText    = lang === 'es' ? 'Restablecer' : 'Reset';
const dragHint     = lang === 'es'
  ? 'Rueda del mouse para zoom · Arrastra para mover'
  : 'Mouse wheel to zoom · Drag to pan';
const noDemoText   = lang === 'es' ? 'Sin demo'    : 'No demo';
---

<section id="projects" class="py-24 lg:py-36 relative overflow-hidden">
  <div class="absolute inset-0 pointer-events-none select-none" aria-hidden="true">
    <div class="proj-grid-bg"></div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">

    <!-- ── Header ── -->
    <div class="mb-16 scroll-reveal">
      <div class="flex items-end justify-between flex-wrap gap-4">
        <div>
          <p class="text-wine-400 light:text-wine-600 text-xs font-mono tracking-[0.2em] uppercase mb-3">
            {lang === 'es' ? '// Portafolio selecto' : '// Selected work'}
          </p>
          <h2 class="text-4xl md:text-6xl font-display font-bold text-text-primary light:text-gray-900 leading-none">
            {lang === 'es' ? 'Proyectos' : 'Projects'}
            <span class="block text-wine-500/30 light:text-wine-300/50 text-2xl md:text-3xl font-light tracking-widest mt-1">
              {String(projects.length).padStart(2,'0')} {lang === 'es' ? 'trabajos' : 'builds'}
            </span>
          </h2>
        </div>
        <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full border border-emerald-500/30 bg-emerald-500/5 text-emerald-400 light:text-emerald-600 text-xs font-mono">
          <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
          {projects.filter(p => p.status === 'live').length} {lang === 'es' ? 'en producción' : 'in production'}
        </span>
      </div>
      <div class="mt-8 flex items-center gap-4">
        <div class="h-px flex-1 bg-gradient-to-r from-wine-700/60 via-wine-700/20 to-transparent"></div>
        <div class="w-1.5 h-1.5 rounded-full bg-wine-600"></div>
      </div>
    </div>

    <!-- ── Filters ── -->
    <div class="flex flex-wrap gap-2 mb-12 scroll-reveal delay-100" id="filters">
      <button class="filter-chip active" data-filter="all">
        <span class="filter-dot"></span>
        {lang === 'es' ? 'Todos' : 'All'}
        <span class="filter-count">{projects.length}</span>
      </button>
      {allTechnologies.map(tech => {
        const count = projects.filter(p =>
          p.technologies.map(t => t.toLowerCase()).includes(tech.toLowerCase())
        ).length;
        return (
          <button class="filter-chip" data-filter={tech.toLowerCase()}>
            <span class="filter-dot"></span>
            {tech}
            <span class="filter-count">{count}</span>
          </button>
        );
      })}
    </div>

    <!-- ── Grid ── -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5" id="projects-grid">
      {projects.map((project, index) => (
        <article
          class="project-card grid-card group relative rounded-xl border border-surface-border light:border-gray-200 bg-surface-card light:bg-wine-900 overflow-hidden"
          data-technologies={project.technologies.map(t => t.toLowerCase()).join(',')}
          data-index={index}
        >
          <!-- Spotlight -->
          <div class="spotlight" aria-hidden="true"></div>

          <!-- Image -->
          <div
            class="relative aspect-[16/9] overflow-hidden cursor-pointer project-image-btn"
            data-image={project.image}
            data-title={project.title}
          >
            <img
              src={project.image}
              alt={project.title}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              loading={index < 3 ? 'eager' : 'lazy'}
            />
            <div class="absolute inset-0 bg-gradient-to-t from-surface-card/80 via-transparent to-transparent light:from-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-end p-3">
              <div class="bg-white/20 backdrop-blur-sm p-2 rounded-lg">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
              </div>
            </div>
            <div class="absolute top-3 left-3">
              <span class={`status-badge status-${project.status}`}>
                {project.status === 'live' && (
                  <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse inline-block mr-1"></span>
                )}
                {statusLabel[project.status as keyof typeof statusLabel]}
              </span>
            </div>
            <span class="absolute bottom-2 right-3 font-mono text-white/15 text-3xl font-bold select-none leading-none">
              {String(index + 1).padStart(2,'0')}
            </span>
          </div>

          <!-- Content -->
          <div class="p-5 flex flex-col gap-3">

            <!-- Title + expand btn -->
            <div class="flex items-start justify-between gap-2">
              <!-- ✅ LIGHT MODE: título blanco forzado con .project-title -->
              <h3 class="project-title font-display font-semibold text-base leading-snug transition-colors">
                {project.title}
              </h3>
              <button
                class="expand-btn shrink-0 w-7 h-7 rounded-lg border border-surface-border light:border-wine-700/40 bg-surface-darker/50 light:bg-wine-800/40 flex items-center justify-center text-text-muted light:text-wine-300/70 hover:border-wine-500 hover:text-wine-400 transition-all duration-200"
                aria-label="Expand description"
                aria-expanded="false"
              >
                <svg class="expand-icon w-3.5 h-3.5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
            </div>

            <!-- Preview (2 lines always visible) -->
            <p class="desc-preview text-text-muted light:text-wine-200/70 text-xs leading-relaxed line-clamp-2">
              {project.description}
            </p>

            <!-- Expanded panel -->
            <div class="desc-expanded overflow-hidden transition-all duration-400 ease-in-out max-h-0 opacity-0">
              <div class="desc-inner pt-2 pb-1 border-t border-surface-border/40 light:border-wine-700/30">
                <p class="text-text-secondary light:text-wine-100/80 text-xs leading-relaxed">
                  {project.description}
                </p>
              </div>
            </div>

            <!-- Tech badges -->
            <div class="flex flex-wrap gap-1.5">
              {project.technologies.slice(0,4).map(tech => (
                <span class="tech-badge text-[10px] px-2 py-0.5">{tech}</span>
              ))}
              {project.technologies.length > 4 && (
                <span class="tech-badge text-[10px] px-2 py-0.5 opacity-60">
                  +{project.technologies.length - 4}
                </span>
              )}
            </div>

            <!-- CTAs -->
            <div class="flex gap-2 pt-2 border-t border-surface-border/50 light:border-wine-700/30 mt-auto">
              {project.github && (
                <a href={project.github} target="_blank" rel="noopener noreferrer"
                   class="cta-btn cta-ghost cta-sm flex-1">
                  <svg class="w-3.5 h-3.5 shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                  </svg>
                  Code
                </a>
              )}
              {project.live ? (
                <a href={project.live} target="_blank" rel="noopener noreferrer"
                   class="cta-btn cta-primary cta-sm flex-1">
                  <svg class="w-3.5 h-3.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                  </svg>
                  Live
                </a>
              ) : (
                <span class="cta-btn cta-disabled cta-sm flex-1 cursor-default select-none">
                  <svg class="w-3.5 h-3.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                  </svg>
                  {noDemoText}
                </span>
              )}
            </div>
          </div>

          <!-- Ripple container -->
          <div class="ripple-container absolute inset-0 pointer-events-none overflow-hidden rounded-xl" aria-hidden="true"></div>
        </article>
      ))}
    </div>
  </div>
</section>

<!-- ── Modal ── -->
<div id="project-modal" class="fixed inset-0 z-50 hidden">
  <div id="project-modal-backdrop" class="absolute inset-0 bg-black/95 backdrop-blur-sm"></div>
  <div class="relative flex flex-col h-full">
    <div class="flex items-center justify-between p-4 text-white z-10">
      <h3 id="project-modal-title" class="text-base font-display font-semibold truncate pr-4"></h3>
      <div class="flex items-center gap-2 shrink-0">
        <div class="hidden sm:flex items-center gap-1 bg-white/10 rounded-lg p-1">
          <button id="zoom-out-btn" class="p-2 hover:bg-white/20 rounded-lg transition-colors" title={zoomOutText}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"/></svg>
          </button>
          <span id="zoom-level" class="text-xs min-w-[2.5rem] text-center font-mono">100%</span>
          <button id="zoom-in-btn" class="p-2 hover:bg-white/20 rounded-lg transition-colors" title={zoomInText}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/></svg>
          </button>
          <button id="zoom-reset-btn" class="p-2 hover:bg-white/20 rounded-lg transition-colors" title={resetText}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
          </button>
        </div>
        <button id="project-modal-close" class="p-2 hover:bg-white/20 rounded-lg transition-colors" title={closeText}>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
    <p class="hidden sm:block text-white/40 text-xs text-center pb-2 font-mono">{dragHint}</p>
    <div id="image-container" class="flex-1 overflow-hidden cursor-grab active:cursor-grabbing flex items-center justify-center">
      <img id="project-modal-image" src="" alt="Project"
        class="max-w-[90vw] md:max-w-[65vw] max-h-[72vh] md:max-h-[82vh] rounded-xl shadow-2xl transition-transform duration-100 select-none"
        draggable="false"/>
    </div>
    <div class="sm:hidden flex items-center justify-center gap-6 p-4">
      <button id="zoom-out-btn-mobile" class="p-3 bg-white/10 hover:bg-white/20 rounded-full transition-colors">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
      </button>
      <span id="zoom-level-mobile" class="text-white text-sm min-w-[3rem] text-center font-mono">100%</span>
      <button id="zoom-in-btn-mobile" class="p-3 bg-white/10 hover:bg-white/20 rounded-full transition-colors">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
      </button>
    </div>
  </div>
</div>

<style>
  /* ── Grid background ── */
  .proj-grid-bg {
    position:absolute; inset:0;
    background-image:
      linear-gradient(rgba(114,47,55,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(114,47,55,0.04) 1px, transparent 1px);
    background-size: 48px 48px;
    mask-image: radial-gradient(ellipse 80% 80% at 50% 50%, black 40%, transparent 100%);
  }
  .light .proj-grid-bg {
    background-image:
      linear-gradient(rgba(114,47,55,0.07) 1px, transparent 1px),
      linear-gradient(90deg, rgba(114,47,55,0.07) 1px, transparent 1px);
  }

  /* ── Filter chips ── */
  .filter-chip {
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 14px; font-size:0.72rem; font-weight:500;
    font-family:var(--font-mono,monospace); border-radius:999px;
    border:1px solid; transition:all 0.2s ease; cursor:pointer;
    @apply border-surface-border text-text-muted bg-surface-card;
  }
  .filter-chip:hover  { @apply border-wine-700/50 text-wine-400 bg-wine-900/10; }
  .filter-chip.active { @apply border-wine-600 text-white bg-wine-700; }
  .light .filter-chip       { @apply border-gray-200 text-gray-500 bg-white; }
  .light .filter-chip:hover { @apply border-wine-300 text-wine-600 bg-wine-50; }
  .light .filter-chip.active{ @apply border-wine-700 text-white bg-wine-700; }
  .filter-dot { width:5px;height:5px;border-radius:50%;background:currentColor;opacity:0.5; }
  .filter-chip.active .filter-dot { opacity:1; }
  .filter-count { padding:1px 6px;border-radius:999px;background:rgba(255,255,255,0.1);font-size:0.62rem; }
  .filter-chip.active .filter-count { background:rgba(255,255,255,0.2); }

  /* ── Spotlight ── */
  .spotlight {
    position:absolute; inset:0; pointer-events:none; z-index:0;
    background: radial-gradient(350px circle at var(--mouse-x,50%) var(--mouse-y,50%), rgba(124,45,62,0.09), transparent 60%);
    opacity:0; transition:opacity 0.35s ease;
  }
  .grid-card:hover .spotlight { opacity:1; }

  /* ── Card base — light mode usa fondo vinotinto oscuro para que el blanco contraste ── */
  .grid-card {
    transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.25s ease;
  }
  .grid-card:hover {
    @apply border-wine-700/40;
    transform: translateY(-3px);
    box-shadow: 0 16px 40px rgba(0,0,0,0.28), 0 0 0 1px rgba(124,45,62,0.1);
  }
  /* Light mode card bg: wine-900 para que el blanco tenga suficiente contraste */
  .light .grid-card {
    background-color: #3b0d14 !important; /* wine-900 equivalente */
    border-color: rgba(124,45,62,0.35) !important;
  }
  .light .grid-card:hover {
    border-color: rgba(124,45,62,0.6) !important;
    box-shadow: 0 12px 32px rgba(59,13,20,0.35), 0 0 0 1px rgba(124,45,62,0.3);
  }

  .grid-card.is-expanded {
    @apply border-wine-600/50;
    box-shadow: 0 0 0 2px rgba(124,45,62,0.3), 0 16px 40px rgba(0,0,0,0.2);
  }
  .grid-card.is-expanded .expand-icon { transform: rotate(180deg); }
  .grid-card.is-expanded .expand-btn {
    @apply border-wine-500 text-wine-400 bg-wine-900/30;
  }

  /* ── ✅ Project title: blanco en AMBOS modos ── */
  .project-title {
    color: #ffffff !important;
  }
  .grid-card:hover .project-title {
    color: #fda4af !important; /* rose-300 — hover suave en ambos modos */
  }

  /* ── Expanded description ── */
  .desc-expanded.open { max-height: 400px; opacity: 1; }

  /* ── Filter animation states ── */
  .project-card {
    /* Estado inicial y base para animación */
    transition:
      opacity 0.35s ease,
      transform 0.35s ease,
      border-color 0.3s ease,
      box-shadow 0.3s ease;
  }

  /* Cuando entra: de invisible/pequeño a normal */
  .project-card.filter-entering {
    animation: cardEnter 0.35s ease forwards;
  }

  /* Cuando sale: de normal a invisible/pequeño */
  .project-card.filter-exiting {
    animation: cardExit 0.25s ease forwards;
  }

  .project-card.hidden-filter {
    display: none;
  }

  @keyframes cardEnter {
    from { opacity: 0; transform: scale(0.88) translateY(10px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  @keyframes cardExit {
    from { opacity: 1; transform: scale(1); }
    to   { opacity: 0; transform: scale(0.88); }
  }

  /* ── Status badges ── */
  .status-badge {
    display:inline-flex; align-items:center;
    padding:3px 8px; font-size:0.58rem; font-weight:600;
    font-family:var(--font-mono,monospace); letter-spacing:0.08em;
    border-radius:4px; backdrop-filter:blur(4px); text-transform:uppercase;
  }
  .status-live     { background:rgba(16,185,129,0.15);color:rgb(52,211,153); border:1px solid rgba(16,185,129,0.3); }
  .status-dev      { background:rgba(245,158,11,0.15); color:rgb(251,191,36); border:1px solid rgba(245,158,11,0.3); }
  .status-archived { background:rgba(100,116,139,0.15);color:rgb(148,163,184);border:1px solid rgba(100,116,139,0.3); }

  /* ── CTAs ── */
  .cta-btn {
    display:inline-flex; align-items:center; justify-content:center; gap:5px;
    font-weight:500; border-radius:8px; transition:all 0.2s ease;
    text-decoration:none; cursor:pointer; white-space:nowrap;
  }
  .cta-sm { padding:7px 12px; font-size:0.7rem; }

  .cta-primary       { @apply bg-wine-700 text-white; }
  .cta-primary:hover { @apply bg-wine-600; transform:translateY(-1px); }

  .cta-ghost         { @apply bg-wine-900/40 text-wine-300 border border-wine-700/50; }
  .cta-ghost:hover   { @apply bg-wine-700 text-white border-wine-700; transform:translateY(-1px); }

  /* En light mode (card oscura) los ghost también se ven bien así */
  .light .cta-ghost       { background:rgba(124,45,62,0.25); color:#fda4af; border-color:rgba(124,45,62,0.4); }
  .light .cta-ghost:hover { @apply bg-wine-600 text-white; border-color:transparent; }

  .cta-disabled { @apply bg-surface-border/20 text-text-muted border border-surface-border/20; opacity:0.45; }

  /* ── Ripple ── */
  .ripple {
    position:absolute; border-radius:50%;
    background:rgba(124,45,62,0.22);
    transform:scale(0);
    animation: rippleAnim 0.55s ease-out forwards;
    pointer-events:none;
  }
  @keyframes rippleAnim {
    to { transform:scale(4); opacity:0; }
  }

  /* ── Modal ── */
  #project-modal.active { display:block; }
  #project-modal-image  { touch-action:none; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {

    /* ── Spotlight ── */
    document.querySelectorAll<HTMLElement>('.grid-card').forEach(card => {
      card.addEventListener('mousemove', (e: MouseEvent) => {
        const r = card.getBoundingClientRect();
        card.style.setProperty('--mouse-x', `${((e.clientX - r.left) / r.width) * 100}%`);
        card.style.setProperty('--mouse-y', `${((e.clientY - r.top) / r.height) * 100}%`);
      });
    });

    /* ── Ripple ── */
    document.querySelectorAll<HTMLElement>('.grid-card').forEach(card => {
      card.addEventListener('click', (e: MouseEvent) => {
        const target = e.target as HTMLElement;
        if (target.closest('a') || target.closest('.project-image-btn') || target.closest('.expand-btn')) return;
        const container = card.querySelector<HTMLElement>('.ripple-container');
        if (!container) return;
        const r    = card.getBoundingClientRect();
        const size = Math.max(r.width, r.height) * 1.5;
        const x    = e.clientX - r.left - size / 2;
        const y    = e.clientY - r.top  - size / 2;
        const el   = document.createElement('span');
        el.classList.add('ripple');
        el.style.cssText = `width:${size}px;height:${size}px;left:${x}px;top:${y}px;`;
        container.appendChild(el);
        el.addEventListener('animationend', () => el.remove());
      });
    });

    /* ── Expand description ── */
    document.querySelectorAll<HTMLElement>('.grid-card').forEach(card => {
      const expandBtn = card.querySelector<HTMLElement>('.expand-btn');
      const expanded  = card.querySelector<HTMLElement>('.desc-expanded');
      const preview   = card.querySelector<HTMLElement>('.desc-preview');
      if (!expandBtn || !expanded) return;

      expandBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = expanded.classList.toggle('open');
        card.classList.toggle('is-expanded', isOpen);
        expandBtn.setAttribute('aria-expanded', String(isOpen));
        preview?.classList.toggle('hidden', isOpen);

        if (isOpen && window.innerWidth < 768) {
          setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 150);
        }
      });
    });

    /* ── Filter con animación ── */
    const filterBtns   = document.querySelectorAll<HTMLElement>('.filter-chip');
    const projectCards = document.querySelectorAll<HTMLElement>('.project-card');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const filter   = btn.getAttribute('data-filter');
        const grid     = document.getElementById('projects-grid');
        const STAGGER  = 40; // ms entre cada card

        // 1️⃣ Calcular qué cards show/hide
        const toShow: HTMLElement[] = [];
        const toHide: HTMLElement[] = [];

        projectCards.forEach(card => {
          const techs   = card.getAttribute('data-technologies')?.split(',') || [];
          const matches = filter === 'all' || techs.includes(filter!);
          if (matches) toShow.push(card);
          else         toHide.push(card);
        });

        // 2️⃣ Animar salida de las que se ocultan
        toHide.forEach((card, i) => {
          card.classList.remove('filter-entering');
          card.classList.add('filter-exiting');
          setTimeout(() => {
            card.classList.add('hidden-filter');
            card.classList.remove('filter-exiting');
          }, 250); // match con cardExit duration
        });

        // 3️⃣ Animar entrada de las que aparecen (con stagger)
        toShow.forEach((card, i) => {
          card.classList.remove('hidden-filter', 'filter-exiting');
          // Pequeño delay para que las salidas empiecen primero
          setTimeout(() => {
            card.classList.remove('filter-entering');
            void (card as HTMLElement).offsetWidth; // force reflow
            card.classList.add('filter-entering');
          }, 60 + i * STAGGER);
        });
      });
    });

    /* ── Zoom Modal ── */
    const modal          = document.getElementById('project-modal');
    const modalImage     = document.getElementById('project-modal-image') as HTMLImageElement;
    const modalTitle     = document.getElementById('project-modal-title');
    const modalClose     = document.getElementById('project-modal-close');
    const modalBackdrop  = document.getElementById('project-modal-backdrop');
    const imageContainer = document.getElementById('image-container');
    const zoomLevel      = document.getElementById('zoom-level');
    const zoomLevelM     = document.getElementById('zoom-level-mobile');

    let scale=1, tx=0, ty=0, dragging=false, sx=0, sy=0;
    const MIN=0.5, MAX=4, STEP=0.25;

    const applyT = () => { if(modalImage) modalImage.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`; };
    const applyD = () => { const p=Math.round(scale*100)+'%'; if(zoomLevel)zoomLevel.textContent=p; if(zoomLevelM)zoomLevelM.textContent=p; };
    const resetZ = () => { scale=1;tx=0;ty=0;applyT();applyD(); };
    const zIn    = () => { if(scale<MAX){scale=Math.min(scale+STEP,MAX);applyT();applyD();} };
    const zOut   = () => { if(scale>MIN){scale=Math.max(scale-STEP,MIN);if(scale<=1){tx=0;ty=0;}applyT();applyD();} };

    imageContainer?.addEventListener('wheel', e=>{e.preventDefault();e.deltaY<0?zIn():zOut();},{passive:false});
    imageContainer?.addEventListener('mousedown', e=>{if(scale>1){dragging=true;sx=e.clientX-tx;sy=e.clientY-ty;(imageContainer as HTMLElement).style.cursor='grabbing';}});
    document.addEventListener('mousemove', e=>{if(dragging){tx=e.clientX-sx;ty=e.clientY-sy;applyT();}});
    document.addEventListener('mouseup', ()=>{dragging=false;if(imageContainer)(imageContainer as HTMLElement).style.cursor=scale>1?'grab':'default';});

    let lastD=0, lastTX=0, lastTY=0;
    imageContainer?.addEventListener('touchstart', e=>{
      if(e.touches.length===2) lastD=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);
      else if(e.touches.length===1&&scale>1){dragging=true;lastTX=e.touches[0].clientX-tx;lastTY=e.touches[0].clientY-ty;}
    },{passive:true});
    imageContainer?.addEventListener('touchmove', e=>{
      if(e.touches.length===2){
        const d=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);
        if(lastD>0){const delta=d-lastD;if(delta>0&&scale<MAX)scale=Math.min(scale+0.02,MAX);else if(delta<0&&scale>MIN)scale=Math.max(scale-0.02,MIN);applyT();applyD();}lastD=d;
      }else if(e.touches.length===1&&dragging){tx=e.touches[0].clientX-lastTX;ty=e.touches[0].clientY-lastTY;applyT();}
    },{passive:true});
    imageContainer?.addEventListener('touchend',()=>{dragging=false;lastD=0;});

    document.getElementById('zoom-in-btn')?.addEventListener('click',zIn);
    document.getElementById('zoom-out-btn')?.addEventListener('click',zOut);
    document.getElementById('zoom-reset-btn')?.addEventListener('click',resetZ);
    document.getElementById('zoom-in-btn-mobile')?.addEventListener('click',zIn);
    document.getElementById('zoom-out-btn-mobile')?.addEventListener('click',zOut);

    document.querySelectorAll('.project-image-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const image = btn.getAttribute('data-image');
        const title = btn.getAttribute('data-title');
        if(image && modalImage && modalTitle && modal){
          resetZ();
          modalImage.src = image;
          modalTitle.textContent = title||'';
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      });
    });

    const closeModal = () => {
      modal?.classList.remove('active');
      document.body.style.overflow='';
      resetZ();
    };
    modalClose?.addEventListener('click',closeModal);
    modalBackdrop?.addEventListener('click',closeModal);
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape')closeModal();
      if(modal?.classList.contains('active')){
        if(e.key==='+'||e.key==='=')zIn();
        if(e.key==='-')zOut();
        if(e.key==='0')resetZ();
      }
    });
  });
</script>